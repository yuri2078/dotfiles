# mysql  数据库基础

## mysql 登陆

```bash
mysql -h hostname -u username -p
```

其中：

- `-h`：表示连接的主机名或 IP 地址；
- `-u`：表示登录的用户名；
- `-p`：表示登录密码，同时也会提示你输入密码

## SQL 语句分类

1. 
2. 
3. 
4. 数据控制语言 (DCL)：Data Control Language，用于授权访问数据库中的对象，如 `GRANT` 和 `REVOKE`。
5. 事务控制语言 (TCL)：Transaction Control Language，用于控制事务的处理，如 `COMMIT`, `ROLLBACK` 和 `SAVEPOINT`。

其中，DDL、DML 和 DQL 是 SQL 中最为常见的语句类型，它们构成了 SQL 查询和数据处理的主要逻辑。

### DDL 语句

> 数据定义语言 (DDL)：Data Definition Language，用于创建、更新或删除数据库中的表和其他对象，如 `CREATE`, `ALTER` 。

1. `CREATE`

   用于在数据库中创建新的表、视图、索引或存储过程。

   示例：创建一个名为 `students` 的表，包含 `id`、`name`、`age` 三列的数据。

   ```sql
   CREATE TABLE students (
       id INT NOT NULL,
       name VARCHAR(20) NOT NULL,
       age INT NOT NULL,
       PRIMARY KEY (id)
   );
   ```

2. `ALTER`

   用于修改数据库中的表、视图、索引或存储过程。

   示例：向 `students` 表中添加一列 `gender`。

   ```sql
   ALTER TABLE students ADD COLUMN gender VARCHAR(10);
   ```

3. `DROP`

   用于删除数据库中的表、视图、索引或存储过程。

   示例：删除 `students` 表。

   ```sql
   DROP TABLE students;
   ```

4. `TRUNCATE`

   用于删除表中的所有行，但不删除表本身。

   示例：删除 `students` 表中的所有数据。

   ```sql
   TRUNCATE TABLE students;
   ```

5. `COMMENT`

   用于给数据库中的对象（如表、列等）添加注释信息。

   示例：给 `students` 表中的 `id` 列添加注释。

   ```sql
   COMMENT ON COLUMN students.id IS '学生编号';
   ```

6. `RENAME`

   用于重命名数据库中的表、视图、索引或存储过程。

   示例：将 `students` 表重命名为 `new_students`。

   ```sql
   RENAME TABLE students TO new_students;
   ```

7. `GRANT`

   用于授权其他用户对数据库中的对象进行访问、修改、删除等操作权限。

   示例：将 `students` 表的 `INSERT` 权限授予给 `user1` 用户。

   ```sql
   GRANT INSERT ON students TO user1;
   ```

8. `REVOKE`

   用于收回其他用户对数据库中的对象的操作权限。

   示例：收回 `user1` 用户对 `students` 表的 `INSERT` 权限。

   ```sql
   REVOKE INSERT ON students FROM user1;
   ```

### DML 语句

> 数据操纵语言 (DML)：Data Manipulation Language，用于操纵表中的数据，如 `SELECT`, `INSERT`, `UPDATE` 和 `DELETE`。

1. `SELECT`

   用于从数据库中查询数据。

   示例：查询 `students` 表中所有学生的信息。

   ```sql
   SELECT * FROM students;
   ```

2. `INSERT`

   用于向数据库中插入新的数据。

   示例：向 `students` 表中插入一条新的学生信息。

   ```sql
   INSERT INTO students (id, name, age) VALUES (1, '张三', 20);
   ```

3. `UPDATE`

   用于修改数据库中已有的数据。

   示例：将 `students` 表中学号为 1 的学生姓名修改为 '李四'。

   ```sql
   UPDATE students SET name = '李四' WHERE id = 1;
   ```

4. `DELETE`

   用于删除数据库中已有的数据。

   示例：删除 `students` 表中学号为 1 的学生信息。

   ```sql
   DELETE FROM students WHERE id = 1;
   ```

5. `MERGE`

   可以根据指定条件判断是否进行插入或更新操作。

   示例：向 `students` 表中插入一条新的学生信息，如果该学生已存在，则更新其信息。

   ```sql
   MERGE INTO students s
   USING (SELECT 1 id, '张三' name, 20 age FROM dual) t
   ON (s.id = t.id)
   WHEN MATCHED THEN
     UPDATE SET s.name = t.name, s.age = t.age
   WHEN NOT MATCHED THEN
     INSERT (id, name, age) VALUES (t.id, t.name, t.age);
   ```

### DQL 语句

> 数据查询语言 (DQL)：Data Query Language，用于查询表中的数据，如 `SELECT` 和 `FROM`。

1. `SELECT`

   用于从数据库中查询数据。

   示例：查询 `students` 表中所有学生的信息。

   ```sql
   SELECT * FROM students;
   ```

2. `INSERT INTO`

   用于向数据库中插入新的数据。

   示例：向 `students` 表中插入一条新的学生信息。

   ```sql
   INSERT INTO students (id, name, age) VALUES (1, '张三', 20);
   ```

3. `UPDATE`

   用于修改数据库中已有的数据。

   示例：将 `students` 表中学号为 1 的学生姓名修改为 '李四'。

   ```sql
   UPDATE students SET name = '李四' WHERE id = 1;
   ```

4. `DELETE`

   用于删除数据库中已有的数据。

   示例：删除 `students` 表中学号为 1 的学生信息。

   ```sql
   DELETE FROM students WHERE id = 1;
   ```

5. `CREATE TABLE`

   用于创建新的数据库表格。

   示例：在数据库中创建一个名为 `courses` 的表格。

   ```sql
   CREATE TABLE courses (
       id INT PRIMARY KEY,
       name VARCHAR(20),
       teacher VARCHAR(20),
       credit FLOAT
   );
   ```

6. `ALTER TABLE`

   用于修改数据库表格结构。

   示例：向 `courses` 表中添加一列 `category`。

   ```sql
   ALTER TABLE courses ADD category VARCHAR(20);
   ```

7. `DROP TABLE`

   用于删除已有的数据库表格。

   示例：删除 `courses` 表格。

   ```sql
   DROP TABLE courses;
   ```

### DCL 语句

>  DCL（数据控制语言）是 SQL 中用于控制数据访问权限和安全性的指令集。以下是其中几个常用的 DCL 指令的解析：

GRANT

`GRANT` 用于向某个用户或用户组授予特定的权限，例如 SELECT、INSERT、UPDATE 或 DELETE。

语法：`GRANT privilege_name ON object_name TO {user_name | public | role_name};`

示例：

```sql
GRANT SELECT, INSERT ON my_table TO user1;
```

上述代码为 user1 授予 my_table 表的 SELECT 和 INSERT 权限。

REVOKE

`REVOKE` 用于撤销一条或多条用户或用户组的权限。

语法：`REVOKE privilege_name ON object_name FROM {user_name | public | role_name};`

示例：

```sql
REVOKE SELECT ON my_table FROM user1;
```

上述代码为 user1 取消 my_table 表的 SELECT 权限。

DENY

`DENY` 用于拒绝一条或多条用户或用户组的权限。

语法：`DENY privilege_name ON object_name TO {user_name | public | role_name};`

示例：

```sql
DENY INSERT ON my_table TO user1;
```

上述代码拒绝 user1 在 my_table 表上执行 INSERT 操作。

 CREATE USER

`CREATE USER` 用于创建一个新用户。

语法：`CREATE USER user_name [IDENTIFIED BY password];`

示例：

```sql
CREATE USER user1 IDENTIFIED BY 'passw0rd';
```

上述代码创建一个名为 user1 的新用户，并将密码设置为 "passw0rd"。

ALTER USER

`ALTER USER` 用于更改现有用户的权限或密码。

语法：`ALTER USER user_name [IDENTIFIED BY [CURRENT_PASSWORD] new_password];`

示例：

```sql
ALTER USER user1 IDENTIFIED BY 'new_passw0rd';
```

上述代码更改 user1 用户的密码为 "new_passw0rd"。

注意，有些数据库管理系统可能会在 `ALTER USER` 命令中支持更多选项。因此，在使用此命令时，应查阅特定系统的文档以查看所有可用选项

## 常用语句

### SHOW

1. `SHOW DATABASES`

   用于显示 MySQL 数据库中所有可用的数据库。

   格式：`SHOW DATABASES;`

   示例：

   ```sql
   SHOW DATABASES;
   ```

   输出：

   ```sql
   +--------------------+
   | Database           |
   +--------------------+
   | information_schema |
   | mysql              |
   | performance_schema |
   | sys                |
   | test_db            |
   +--------------------+
   ```

2. `SHOW TABLES`

   用于显示数据库中所有可用的表格。

   格式：`SHOW TABLES;`

   示例：

   ```sql
   SHOW TABLES;
   ```

   输出：

   ```
   +----------------------+
   | Tables_in_test_db     |
   +----------------------+
   | customers            |
   | orders               |
   | products             |
   +----------------------+
   ```

3. `SHOW COLUMNS`

   用于显示表格中的列信息。

   格式：`SHOW COLUMNS FROM table_name;`

   示例：

   ```sql
   SHOW COLUMNS FROM customers;
   ```

   输出：

   ```
   +---------+-------------+------+-----+---------+----------------+
   | Field   | Type        | Null | Key | Default | Extra          |
   +---------+-------------+------+-----+---------+----------------+
   | id      | int         | NO   | PRI | NULL    | auto_increment |
   | name    | varchar(50) | YES  |     | NULL    |                |
   | email   | varchar(50) | YES  |     | NULL    |                |
   | country | varchar(50) | YES  |     | NULL    |                |
   +---------+-------------+------+-----+---------+----------------+
   ```

4. `SHOW INDEX`

   用于显示表格中的索引信息。

   格式：`SHOW INDEX FROM table_name;`

   示例：

   ```sql
   SHOW INDEX FROM customers;
   ```

   输出：

   ```
   +-----------+------------+-----------+--------------+-------------+-----------+-------------+----------
   | Table     | Non_unique | Key_name  | Seq_in_index | Column_name | Collation | Cardinality | Sub_part 
   +-----------+------------+-----------+--------------+-------------+-----------+-------------+----------
   | customers |          0 | PRIMARY   |            1 | id          | A         |           3 |     NULL 
   | customers |          1 | email_idx |            1 | email       | A         |           3 |     NULL 
   +-----------+------------+-----------+--------------+-------------+-----------+-------------+----------
   ```

   注意：`SHOW INDEX` 关键字仅在 MySQL/MariaDB 数据库系统中可用。在 Oracle 和 SQL Server 等其他数据库管理系统中，请查看相应的文档来了解它们使用的特定指令

### ALTER 

> `ALTER` 指令用于修改已存在的数据库表结构。

以下是 `ALTER` 指令的格式及详细信息：

1. `ALTER TABLE ADD COLUMN`

   用于向表中添加新的列。

   格式：`ALTER TABLE table_name ADD COLUMN column_name data_type;`

   示例：

   ```sql
   ALTER TABLE customers ADD COLUMN phone VARCHAR(20);
   ```

   注意: `ADD COLUMN` 子句是风格最为统一和约定俗成的。但是因为支持数据库管理系统的差异，实际使用时应该先查看相应的文档来学习具体语法。

2. `ALTER TABLE MODIFY COLUMN`

   用于修改表中已有的列的数据类型和约束。

   格式：`ALTER TABLE table_name MODIFY COLUMN column_name new_data_type;`

   示例：

   ```sql
   ALTER TABLE customers MODIFY COLUMN email VARCHAR(50) NOT NULL;
   ```

   注意：`MODIFY COLUMN` 用于修改数据类型，还有其他选项，如 `DEFAULT` 和 `NOT NULL` 等。

3. `ALTER TABLE DROP COLUMN`

   用于删除表中的列。

   格式：`ALTER TABLE table_name DROP COLUMN column_name;`

   示例：

   ```sql
   ALTER TABLE customers DROP COLUMN phone;
   ```

4. `ALTER TABLE RENAME TO`

   用于修改数据库表的名称。

   格式：`ALTER TABLE old_table_name RENAME TO new_table_name;`

   示例：

   ```sql
   ALTER TABLE customers RENAME TO clients;
   ```

5. `ALTER TABLE ADD CONSTRAINT`

   用于添加表中新的约束。

   格式：`ALTER TABLE table_name ADD CONSTRAINT constraint_name constraints_definition;`

   示例：

   ```sql
   ALTER TABLE orders ADD CONSTRAINT fk_customer FOREIGN KEY (customer_id) REFERENCES customers (id);
   ```

   注意：`ADD CONSTRAINT` 用于添加任何类型的约束。它可以增加唯一性约束、外键约束、主键约束或检查约束等

### DROP 

> `DROP` 指令用于删除数据库中的对象，比如表、索引、数据列等。

以下是 `DROP` 指令的格式及详细信息：

1. `DROP TABLE`

   用于删除数据库中的一个表。

   格式：`DROP TABLE table_name;`

   示例：

   ```sql
   DROP TABLE customers;
   ```

2. `DROP INDEX`

   用于删除数据库中的一个索引。

   格式：`DROP INDEX index_name ON table_name;`

   示例：

   ```sql
   DROP INDEX email_idx ON customers;
   ```

3. `DROP COLUMN`

   用于删除表中的一个列。

   格式：`ALTER TABLE table_name DROP COLUMN column_name;`

   示例：

   ```sql
   ALTER TABLE customers DROP COLUMN phone;
   ```

4. `DROP CONSTRAINT`

   用于删除表中的一个约束。

   格式：`ALTER TABLE table_name DROP CONSTRAINT constraint_name;`

   示例：

   ```sql
   ALTER TABLE orders DROP CONSTRAINT fk_customer;
   ```

5. `DROP VIEW`

   用于删除一个视图。

   格式：`DROP VIEW view_name;`

   示例：

   ```sql
   DROP VIEW customer_view;
   ```

6. `DROP FUNCTION`

   用于删除一个函数。

   格式：`DROP FUNCTION function_name;`

   示例：

   ```sql
   DROP FUNCTION calculate_discount;
   ```

7. `DROP PROCEDURE`

   用于删除一个存储过程。

   格式：`DROP PROCEDURE procedure_name;`

   示例：

   ```sql
   DROP PROCEDURE get_customer_orders;
   ```

## DQL 语句

### 执行顺序

执行顺序如下：

1. FROM 子句

   在执行查询前，需要指定要从哪个表中获取数据。这是通过 FROM 子句来实现的。

2. JOIN 子句

   如果在查询中使用了 JOIN 子句来联接多张表，则需要在 FROM 子句后使用 JOIN 子句。

3. WHERE 子句

   一旦指定了要查询的表和任何联接操作，WHERE 子句就会用于筛选表中的数据。

4. GROUP BY 子句

   如果查询需要按一个或多个列来分组数据，则可以使用 GROUP BY 子句。

5. HAVING 子句

   如果需要在已分组的数据上进一步筛选数据，则可以使用 HAVING 子句。

6. SELECT 子句

   完成了 WHERE、GROUP BY 和 HAVING 子句之后，可以使用 SELECT 子句来指定要返回的列。

7. ORDER BY 子句

   最后，可以使用 ORDER BY 子句以特定的方式对返回的数据进行排序。

注意，尽管 WHERE 和 HAVING 子句的作用相似，但 WHERE 子句在 GROUP BY 子句之前执行，而 HAVING 子句在 GROUP BY 子句之后执行。这就是为什么 HAVING 子句可以引用聚合函数（如 COUNT、SUM 等），而 WHERE 子句不行。

## 函数

### 字符串函数

1. `LENGTH(str)`：返回字符串 `str` 的字符数。
2. `LEFT(str, len)`：返回字符串 `str` 的前 `len` 个字符。
3. `RIGHT(str, len)`：返回字符串 `str` 的后 `len` 个字符。
4. `SUBSTRING(str, pos, len)`：返回字符串 `str` 从位置 `pos` 开始的长度为 `len` 的子字符串。
5. `CONCAT(str1, str2, ..., strN)`：将多个字符串连接为���个字符串。
6. `REPLACE(str, from_str, to_str)`：将字符串 `str` 中的所有 `from_str` 替换为 `to_str`。
7. `UCASE(str)` 或 `UPPER(str)`：将字符串 `str` 转换为大写字母。
8. `LCASE(str)` 或 `LOWER(str)`：将字符串 `str` 转换为小写字母。
9. `TRIM([{BOTH | LEADING | TRAILING} [trim_str] FROM] str)`：从字符串 `str` 的开头和结尾删除指定的 `trim_str` 字符。如果未指定 `trim_str`，则删除空格。
10. `LPAD(str, len, pad_str)`：使用 `pad_str` 在左侧填充字符串 `str`，使其成为长度为 `len` 的字符串。
11. `RPAD(str, len, pad_str)`：使用 `pad_str` 在右侧填充字符串 `str`，使其成为长度为 `len` 的字符串。

```sql
SELECT LENGTH('Hello, World!');-- 计算字符串长度
SELECT LEFT('Hello, World!', 3);-- 返回字符串的前三个字符
SELECT RIGHT('Hello, World!', 6);-- 返回字符串中的第6个字符及其后面的所有字符
SELECT SUBSTRING('Hello, World!', 8, 4);-- 返回字符串中从第8个字符开始的4个字符
SELECT CONCAT('Hello', ', ', 'World', '!');-- 连接多个字符串
SELECT REPLACE('Hello, World!', ',', '.');-- 将字符串中的所有逗号替换为句号
SELECT UPPER('Hello, World!');-- 转换字符串为大写字符
SELECT TRIM('   Hello, World!   ');-- 从字符串中删除开头和结尾的空格字符
SELECT LPAD('1234', 10, '0');-- 在字符串的左侧填充零，使其成为长度为10的字符串
SELECT RPAD('Hello', 20, ' ');-- 在字符串的右侧填充空格，使其成为长度为20的字符串
```

### 数值函数

1. `ABS(x)`：返回 x 的绝对值。
2. `CEILING(x)` 或 `CEIL(x)`：返回不小于 x 的最小整数。
3. `FLOOR(x)`：返回不大于 x 的最大整数。
4. `ROUND(x)`：将 x 四舍五入为最接近的整数。
5. `TRUNCATE(x, d)`：将 x 截断为 d 位小数。
6. `MOD(x, y)` 或 `%`：返回 x 除以 y 的余数。
7. `POW(x, y)` 或 `POWER(x,y)`：返回 x 的 y 次幂。

```sql
SELECT ABS(-10);-- 返回-10的绝对值
SELECT CEIL(2.5);-- 返回不小于2.5的最小整数
SELECT FLOOR(2.5);-- 返回不大于2.5的最大整数
SELECT ROUND(3.7);-- 将3.7四舍五入为最接近的整数
SELECT TRUNCATE(3.746, 2);-- 将3.746截断为2位小数
SELECT MOD(10, 3);-- 返回10除以3的余数
SELECT POW(2, 3);-- 返回2的3次幂
```



### 日期函数

1. `NOW()`：返回当前日期和时间。

2. `CURDATE()`：返回当前日期。

3. `CURTIME()`：返回当前时间。

4. `DATE_FORMAT(date, format)`：将日期格式化为特定的字符串格式。

5. `DATE_ADD(date, INTERVAL expr unit)`：向日期添加指定的时间间隔。

6. `DATE_SUB(date, INTERVAL expr unit)`：从日期中减去指定时间间隔。

7. `DATEDIFF(date1, date2)`：计算两个日期之间的天数。

8. ```sql
   SELECT NOW();-- 返回当前日期和时间
   SELECT CURDATE();-- 返回当前日期
   SELECT CURTIME();-- 返回当前时间
   SELECT DATE_FORMAT(NOW(), '%Y-%m-%d');-- 将日期格式化为 'YYYY-MM-DD' 形式
   SELECT DATE_FORMAT(NOW(), '%Y年%m月%d日');-- 将日期格式化为 'YYYY年M月D日' 形式
   SELECT DATE_ADD(NOW(), INTERVAL '2 3:00:00' DAY_SECOND);-- 在日期上添加2天和3小时
   SELECT DATE_SUB(NOW(), INTERVAL 1 MONTH);-- 从日期中减去1个月
   SELECT DATEDIFF('2022-01-01', '2021-12-15');-- 计算两个日期之间的天数
   ```

### 流程函数

1. `IF(condition, if_true, if_false)`：如果 condition 为真，则返回 if_true，否则返回 if_false。
2. `CASE expression WHEN value THEN result [WHEN ...] [ELSE default] END`：根据 expression 的结果返回对应的 result，如果没有匹配，则返回 default。
3. `NULLIF(expr1, expr2)`：如果 expr1 等于 expr2，则返回 NULL，否则返回 expr1。
4. `COALESCE(expr1, expr2, ...)`：返回第一个非 NULL 表达式的值。

```sql
-- 如果 score > 60，则返回 '及格'，否则返回 '不及格'
SELECT IF(score > 60, '及格', '不及格') as result FROM student;

-- 根据 score 的值返回不同的分数段
SELECT CASE WHEN score >= 90 THEN '优秀'
            WHEN score >= 80 THEN '良好'
            WHEN score >= 70 THEN '一般'
            WHEN score >= 60 THEN '及格'
            ELSE '不及格' END as result FROM student;

-- 如果 name 等于 'Tom'，则返回 NULL，否则返回 name
SELECT NULLIF(name, 'Tom') as result FROM student;

-- 返回第一个非 NULL 的值
SELECT COALESCE(phone, email, address) as contact FROM student;
```

